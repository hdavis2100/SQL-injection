<!DOCTYPE html>
<html lang="en">    





<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        input {
            width: 90%;
        }
    </style>
</head>
<body>
    <h2> Login:</h2>
    
    
    Username: <input type="text" id="username" name="username"><br>
    Password: <input type="password" id="password" name="password"><br>
    <button id="loginBtn" onclick="loginUser()">Login</button>

    <h2 id="m" hidden> Messages:</h2>

    <ul id="messages">

    </ul>

    <h2 id="f" hidden> Find users by name and email:</h2>
    <input type="text" id="searchKey" name="searchKey" hidden><br>
    <button id="searchBtn" onclick="getUsers()" hidden>Search</button>
    <ul id="userResults">

    </ul>

    <button id="logoutBtn" hidden onclick="logout()">Logout</button>
<script>

function loginUser() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    data = {username: username, password: password};

    fetch('login.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)

    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        const messagesList = document.getElementById('messages');
        messagesList.innerHTML = '';
        if(data.status === 'Logged in successfully') {
            data.messages.forEach(msg => {
                const li = document.createElement('li');
                const sender = msg.sender;
                const recipient = msg.recipient;
                const message = msg.message;
                li.textContent = `${sender} to ${recipient}: ${message}`;


                messagesList.appendChild(li);
            });
            document.getElementById('username').hidden = true;
            document.getElementById('password').hidden = true;
            document.getElementById('loginBtn').hidden = true;
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('logoutBtn').hidden = false;
            document.getElementById('m').hidden = false;
            document.getElementById('f').hidden = false;
            document.getElementById('searchKey').hidden = false;
            document.getElementById('searchBtn').hidden = false;

        } else {
            const li = document.createElement('li');
            li.textContent = 'Login failed';
            messagesList.appendChild(li);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });

}

function getUsers(){
    const key = document.getElementById('searchKey').value;
    data = {searchKey: key};
    fetch('search.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)

    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        const userResultsList = document.getElementById('userResults');
        userResultsList.innerHTML = '';
        data.forEach(user => {
            const li = document.createElement('li');
            li.textContent = `${user.username} (${user.email})`;
            userResultsList.appendChild(li);
        });
    })
    .catch(error => {
        console.error('Error:', error);
    });

}

function logout() {
    
    document.getElementById('username').hidden = false;
    document.getElementById('password').hidden = false;
    document.getElementById('loginBtn').hidden = false;
    document.getElementById('logoutBtn').hidden = true;
    document.getElementById('messages').innerHTML = '';
    document.getElementById('m').hidden = true;
    document.getElementById('f').hidden = true;
    document.getElementById('searchKey').hidden = true;
    document.getElementById('searchBtn').hidden = true;
    document.getElementById('userResults').innerHTML = '';
}





</script>

</body>


</html>